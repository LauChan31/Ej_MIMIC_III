{"cells":[{"cell_type":"markdown","id":"6c5efb1e-a96a-4c51-9d3d-16222e28473c","metadata":{"id":"6c5efb1e-a96a-4c51-9d3d-16222e28473c"},"source":["# Visualise IAC groups (aline study step 9)\n","Indwelling arterial catheters (IACs) are being used to monitor hemodynamics and also for blood gas analysis. However, those catheters  pose serious risks such as infections or vascular problems. The MIMIC-III dataset can be used to study if IAC use is associated with mortality in patients on the ICU. The queries in this notebook are based on the following paper:\n","\n","Hsu, D. J., Feng, M., Kothari, R., Zhou, H., Chen, K. P., & Celi, L. A. (2015). The association between indwelling arterial catheters and mortality in hemodynamically stable patients with respiratory failure: a propensity score analysis. Chest, 148(6), 1470-1476. <br> <br>"]},{"cell_type":"code","execution_count":null,"id":"d9c56e91-b8d1-442b-9a61-5874f97e3ca1","metadata":{"id":"d9c56e91-b8d1-442b-9a61-5874f97e3ca1"},"outputs":[],"source":["pip install seaborn"]},{"cell_type":"markdown","id":"45f38d6b-d062-4a0d-ae2d-36d01edbb3f1","metadata":{"id":"45f38d6b-d062-4a0d-ae2d-36d01edbb3f1"},"source":["__Store patients, demographics and heart rate data into a Pandas dataframe:__"]},{"cell_type":"code","execution_count":null,"id":"4bfc2704-0d06-4ce2-9db1-70f30d740c9b","metadata":{"id":"4bfc2704-0d06-4ce2-9db1-70f30d740c9b"},"outputs":[],"source":["query = \\\n","\"\"\"\n","SELECT * FROM adult_patients ap\n","\"\"\"\n","\n","adult_patients = pd.read_sql_query(query, con)\n","\n","query = \\\n","\"\"\"\n","SELECT * FROM patients p\n","\"\"\"\n","\n","patients = pd.read_sql_query(query, con)\n","patients.head()\n","\n","query = \\\n","\"\"\"\n","SELECT i.icustay_id, ce.itemid, ce.valuenum\n","        FROM mimiciii.icustays i\n","        LEFT JOIN mimiciii.chartevents ce\n","        ON i.icustay_id = ce.icustay_id\n","        AND ce.charttime between i.intime - interval '12' hour and i.outtime + interval '12' hour\n","        AND ce.itemid in \"\"\" + str(vital_data_ids['heart_rate']) + \"\"\"\n","        GROUP BY i.icustay_id, ce.itemid, ce.valuenum\n","\"\"\"\n","\n","vitals = pd.read_sql_query(query, con)\n","vitals.head()"]},{"cell_type":"code","execution_count":null,"id":"77c8a96c-0916-4dfd-a6ed-38cd0d68982a","metadata":{"id":"77c8a96c-0916-4dfd-a6ed-38cd0d68982a"},"outputs":[],"source":["def get_age(row):\n","    intime = row['intime']\n","    subject_id = row['subject_id']\n","\n","    if subject_id in patients['subject_id']:\n","        dob = patients[patients['subject_id']==subject_id]['dob'].values[0]\n","\n","        return (intime - dob).days/365\n","    return None\n","\n","adult_patients['intime'] = pd.to_datetime(adult_patients['intime'])\n","patients['dob'] = pd.to_datetime(patients['dob'])\n","\n","adult_patients['age'] = adult_patients.apply(get_age,axis=1)"]},{"cell_type":"markdown","id":"bc20ad3e-aa2f-4b4b-8436-aacb8d78db48","metadata":{"id":"bc20ad3e-aa2f-4b4b-8436-aacb8d78db48"},"source":["__Visualise all variables in the adult_patients table:__"]},{"cell_type":"code","execution_count":null,"id":"54fa4f1f-57ca-443d-a9dc-0b7de5cf98b3","metadata":{"id":"54fa4f1f-57ca-443d-a9dc-0b7de5cf98b3"},"outputs":[],"source":["for col in adult_patients.columns:\n","    if adult_patients.dtypes[col] in ('int64', 'float64'):\n","        plt.figure(figsize=[12,6])\n","        plt.hist(adult_patients[col].dropna(), bins=50, density=True)\n","        plt.xlabel(col, fontsize=24)\n","        plt.show()"]},{"cell_type":"code","execution_count":null,"id":"cd701e2d-8baf-4b06-b83c-3c208dcf13aa","metadata":{"id":"cd701e2d-8baf-4b06-b83c-3c208dcf13aa"},"outputs":[],"source":["adult_patients_set =  dict(zip(adult_patients['icustay_id'], adult_patients['iac_group']))\n","\n","def get_group(icustay_id):\n","    if icustay_id in adult_patients_set:\n","        return adult_patients_set.get(icustay_id)\n","    return None\n","\n","vitals['group'] = vitals['icustay_id'].apply(get_group)"]},{"cell_type":"markdown","id":"70e76229-a86f-4a92-bf52-95f6cc18373c","metadata":{"id":"70e76229-a86f-4a92-bf52-95f6cc18373c"},"source":["__Remove heart rate outliers (for plotting purposes):__"]},{"cell_type":"code","execution_count":null,"id":"b4c138f2-7023-4014-8cc0-0ce1d412a3be","metadata":{"id":"b4c138f2-7023-4014-8cc0-0ce1d412a3be"},"outputs":[],"source":["#removing outliers\n","vitals = vitals[vitals['valuenum']<vitals.valuenum.quantile(0.95)]\n","\n","iac_group = vitals[vitals['group']==1]\n","not_iac_group = vitals[vitals['group']==0]"]},{"cell_type":"markdown","id":"43e07c78-b271-4b06-ac2a-318e932fb214","metadata":{"id":"43e07c78-b271-4b06-ac2a-318e932fb214"},"source":["__Visualise the data by group, using Seaborn:__"]},{"cell_type":"code","execution_count":null,"id":"8679fe30-3336-47ca-8b86-61d1c8ab8761","metadata":{"id":"8679fe30-3336-47ca-8b86-61d1c8ab8761"},"outputs":[],"source":["sns.distplot(adult_patients[adult_patients['iac_group']==1].age, label='IAC Group')\n","sns.distplot(adult_patients[adult_patients['iac_group']==0].age, label='Not IAC Group')\n","plt.legend(loc='upper right')\n","plt.title(\"Age per Group\")\n","plt.xlabel(\"Years\")\n","plt.show()"]},{"cell_type":"code","execution_count":null,"id":"fa5761c0-8bf7-428a-910c-8dd872ccb454","metadata":{"id":"fa5761c0-8bf7-428a-910c-8dd872ccb454"},"outputs":[],"source":["sns.distplot(iac_group.valuenum, label='IAC Group')\n","sns.distplot(not_iac_group.valuenum, label='Not IAC Group')\n","plt.legend(loc='upper right')\n","plt.title(\"Heart Rate per Group\")\n","plt.xlabel(\"Heart Rate\")\n","plt.show()"]}],"metadata":{"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.8.5"},"colab":{"provenance":[]}},"nbformat":4,"nbformat_minor":5}